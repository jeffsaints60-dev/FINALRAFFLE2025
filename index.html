<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MANZON STORE Raffle Elimination 2025</title>
<style>
body{
  font-family: Arial, sans-serif;
  margin:0;
  background:#f0fdf4;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  height:100vh;
}
h1{font-size:18px;text-align:center;margin-bottom:10px}
canvas{border:6px solid #14532d;border-radius:50%}
button{
  margin-top:10px;
  padding:10px 18px;
  border:none;
  border-radius:10px;
  background:#16a34a;
  color:#fff;
  font-size:16px;
}
#winnerPopup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
#winnerBox{
  background:#fff;
  padding:25px;
  border-radius:16px;
  text-align:center;
  box-shadow:0 0 25px rgba(0,0,0,.4);
}
#winnerBox h2{margin:0;font-size:26px;color:#16a34a}
.confetti, .sadFace{
  position:fixed;
  font-size:24px;
  top:-30px;
  z-index:9999;
}
</style>
</head>
<body>

<h1>MANZON STORE Raffle Elimination 2025</h1>

<canvas id="wheel" width="400" height="400"></canvas>
<button id="spinBtn">SPIN</button>

<div id="winnerPopup">
  <div id="winnerBox">
    <h2 id="winnerName"></h2>
  </div>
</div>

<audio id="spinSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_36c2a6a7e6.mp3"></audio>
<audio id="winSound" src="https://cdn.pixabay.com/audio/2022/10/18/audio_9d0fa1b1d1.mp3"></audio>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

let players = [
 "Ate Budda and Marvin","April and Na Fely","Bulak Fam","Ate Shy","Belen Fam","Manzon Fam",
 "Nay Fe and Geke Elizer","Lontoc Fam","Richard Fam","Tiya Ela","Adilo","Buree","Botts","Kayot and Make","Tito Boy","Te Fe",
 "Te Icel and Toto","Te Udet","Tiyo Ising"
];

const finalThree = ["Te Icel and Toto","Te Udet","Tiyo Ising"];
let angle = 0;
let spinning = false;
const center = canvas.width/2;

function sliceAngle(){ return 2*Math.PI/players.length; }

function drawWheel(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  players.forEach((name,i)=>{
    const start = angle + i*sliceAngle();
    ctx.beginPath();
    ctx.moveTo(center,center);
    ctx.arc(center,center,center,start,start+sliceAngle());
    ctx.fillStyle=`hsl(${i*360/players.length},70%,50%)`;
    ctx.fill();

    ctx.save();
    ctx.translate(center,center);
    ctx.rotate(start+sliceAngle()/2);
    ctx.textAlign="right";
    ctx.fillStyle="#fff";
    ctx.font="bold 14px Arial";
    ctx.fillText(name,center-10,5);
    ctx.restore();
  });

  // pointer
  ctx.fillStyle="red";
  ctx.beginPath();
  ctx.moveTo(center,0);
  ctx.lineTo(center-12,22);
  ctx.lineTo(center+12,22);
  ctx.fill();
}

drawWheel();

// Confetti animation
function confetti(){
  for(let i=0;i<100;i++){
    const c=document.createElement("div");
    c.className="confetti";
    c.style.left=Math.random()*innerWidth+"px";
    c.style.color=`hsl(${Math.random()*360},80%,60%)`;
    c.innerHTML = "ðŸŽ‰";
    document.body.appendChild(c);
    let y=0;
    const fall=()=>{
      y+=2+Math.random()*3;
      c.style.top=y+"px";
      if(y<innerHeight) requestAnimationFrame(fall);
      else c.remove();
    };
    fall();
  }
}

// Sad face animation
function sadFace(){
  const f = document.createElement("div");
  f.className="sadFace";
  f.style.left=Math.random()*innerWidth+"px";
  f.innerHTML="ðŸ˜¢";
  document.body.appendChild(f);
  let y=0;
  const fall=()=>{
    y+=2+Math.random()*2;
    f.style.top=y+"px";
    if(y<innerHeight) requestAnimationFrame(fall);
    else f.remove();
  };
  fall();
}

function spinWheel(){
  if(spinning) return;
  spinning = true;

  const spinSound = document.getElementById("spinSound");
  const winSound = document.getElementById("winSound");
  spinSound.currentTime = 0;
  spinSound.play();

  let winnerIndex;
  const remainingCount = players.length;

  if(remainingCount > 3){
    // Random elimination among players NOT in finalThree
    let eligible = players.filter(p=>!finalThree.includes(p));
    winnerIndex = players.indexOf(eligible[Math.floor(Math.random()*eligible.length)]);
  } else if(remainingCount === 3){
    // Second-to-last spin: remove "Te Icel and Toto"
    winnerIndex = players.indexOf("Te Icel and Toto");
  } else if(remainingCount === 2){
    // Last spin: only Tiyo Ising remains
    winnerIndex = players.indexOf("Tiyo Ising");
  }

  const target = (3*Math.PI/2) - (winnerIndex*sliceAngle() + sliceAngle()/2);
  const totalRotation = 12*2*Math.PI + target;
  const duration = 7000;
  const start = performance.now();

  function animate(t){
    const p = Math.min((t-start)/duration,1);
    const ease = 1-Math.pow(1-p,3);
    angle = ease*totalRotation;
    drawWheel();
    if(p<1){
      requestAnimationFrame(animate);
    } else {
      spinning=false;
      spinSound.pause();
      document.getElementById("winnerName").textContent=players[winnerIndex];
      document.getElementById("winnerPopup").style.display="flex";

      // Show confetti for final three spins, sad face for others
      if(remainingCount <= 3){
        winSound.currentTime=0;
        winSound.play();
        confetti();
      } else {
        sadFace();
      }

      // Remove eliminated player if not the last winner
      if(remainingCount > 1){
        players.splice(winnerIndex,1);
        drawWheel();
      }
    }
  }
  requestAnimationFrame(animate);
}

document.getElementById("spinBtn").onclick=spinWheel;
document.getElementById("winnerPopup").onclick=()=>{ document.getElementById("winnerPopup").style.display="none"; };
</script>

</body>
</html>
